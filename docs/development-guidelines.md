# 開発・レビュー運用ガイドライン

本ドキュメントは，POSL 物品管理自動化ツールを GitHub 上でチーム開発するにあたり，
属人化を防ぎ，安定した品質で開発を進めるための取り決めをまとめたものである．

---

## 1. ブランチ運用ルール

### 基本方針

* `main` ブランチは常に **デプロイ可能な状態** を保つ
* `main` への直接 push は禁止する
* すべての変更は Pull Request（PR）経由で取り込む

### ブランチ命名規則

* `feature/xxx` : 新機能追加
* `fix/xxx` : バグ修正
* `chore/xxx` : 設定変更・リファクタリング等
* `docs/xxx` : ドキュメント整備

---

## 2. Issue 駆動開発

### Issue を作成するタイミング

* 新機能の追加
* 仕様変更・設計変更
* バグ修正

### Issue に含める内容

* 目的（何を達成したら完了か）
* 関連ドキュメント（ER 図・シーケンス図など）
* Done 条件（レビュー観点）

---

## 3. Pull Request 運用

### Pull Request の基本ルール

* 必ず対応する Issue を紐づける（例：`Closes #3`）
* 変更はできるだけ小さく分割する
* マージ前に CI がすべて通過していること

---

## 4. レビュー方針（重要）

レビューでは **コードの好み** ではなく，
**設計意図・安全性・将来の保守性** を重視する．

### 主なレビュー観点

#### 設計・仕様

* シーケンス図・仕様書と処理の流れが一致しているか
* ドメインロジックが Slack / Web 層に漏れていないか

#### 正当性・安全性

* 権限チェック（管理者のみ削除等）が正しく実装されているか
* 貸出・返却処理で状態不整合が起きないか
* 必要な処理がトランザクションで保護されているか

#### データ管理

* 重要な操作（貸出・返却・削除）が履歴として必ず保存されているか
* Prisma の型安全性を損なう実装（`any` 等）がないか

#### 可読性・保守性

* 命名が役割を正しく表しているか
* 将来の機能追加を妨げる構造になっていないか

### レビューコメントの姿勢

* 「なぜそう実装したか」を確認する
* 代替案がある場合は理由とともに提案する
* 軽微な指摘はまとめて行う

---

## 5. コーディング・品質担保

* フォーマット・Lint は Biome に完全に委ねる
* API の入力値は Zod で必ず検証する
* ドメインロジックは可能な限り純関数として実装する

---

## 6. セキュリティ・運用

* Slack Token / DB URL 等の機密情報は GitHub に含めない
* `.env.example` を用意し，必要な環境変数を明示する
* DB バックアップ手順を README に記載する

---

## 7. 本ドキュメントの更新

* 開発体制や規模の変化に応じて随時更新する
* 重要な変更は Issue・PR を通じて合意を取る

---

本ガイドラインは，チーム全員が安心して変更を加えられる開発体制を維持するためのものである．
